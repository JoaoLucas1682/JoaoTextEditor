<!DOCTYPE html>
<html lang="pt-BR">

	<head>
		<meta charset="UTF-8">
		<title>Joao TextEditor</title>
		<style>
			* {
				transition: .3s;
			}

			body {
				margin: 0;
				font-family: 'Consolas', monospace;
				background: #1e1e1e;
				color: #fff;
				overflow: hidden;
				border: 1px solid #333;
			}

			header {
				background: #3a3a3a;
				padding: 10px;
				display: flex;
				justify-content: space-between;
				align-items: center;
				font-weight: bold;
				border-bottom: 1px solid grey;
			}

			button {
				margin-left: 10px;
				padding: 6px 12px;
				background: #007acc;
				border: none;
				color: white;
				cursor: pointer;
				border-radius: 1em;
			}

			button:hover {
				background: #0999f8;
			}

			textarea {
				margin: 2px;
				width: 100%;
				height: calc(100vh - 80px);
				background: #252526;
				color: #f5f5f5;
				border: none;
				resize: none;
				padding: 10px;
				box-sizing: border-box;
				font-size: 17px;
				line-height: 1.6;
				font-weight: 500;
				letter-spacing: 0.5px;
				font-kerning: normal;
				hyphens: auto;
				text-rendering: optimizeLegibility;
				-webkit-font-smoothing: antialiased;
				overflow-wrap: break-word;
				white-space: pre-wrap;
				tab-size: 4;
			}

			#contextMenu {
				position: absolute;
				background: #2d2d30;
				border: 1px solid #444;
				border-radius: 4px;
				display: none;
				z-index: 1000;
				box-shadow: 0 0 5px #000;
			}

			#contextMenu ul {
				list-style: none;
				margin: 0;
				padding: 5px 0;
			}

			#contextMenu li {
				padding: 8px 20px;
				cursor: pointer;
			}

			#contextMenu li:hover {
				background: #007acc;
			}

			:focus {
				outline: none;
			}

			header *,
			button,
			#contextMenu li {
				user-select: none;
				-moz-user-select: none;
				-webkit-user-select: none;
			}

			#counter {
				padding: 6px 10px;
				font-size: 12px;
				color: #ccc;
				text-align: right;
				background: #1e1e1e;
				border-top: 1px solid #444;
				font-family: 'Consolas', monospace;
			}

			#loadingScreen {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
				background: #1e1e1e;
				color: #fff;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				z-index: 999999;
			}

			.loader {
				border: 6px solid #3a3a3a;
				border-top: 6px solid #007acc;
				border-radius: 50%;
				width: 50px;
				height: 50px;
				animation: spin 1s linear infinite;
				margin-bottom: 20px;
			}

			body.light-theme {
				background: #fdfdfd;
				color: #222;
			}

			body.light-theme textarea {
				background: #fff;
				color: #000;
			}

			body.light-theme header {
				background: #ddd;
				color: #000;
				box-shadow: 0 0 5px #aaa;
				border: 1px solid #ccc;
			}

			body.light-theme button {
				background: #007acc;
				color: #fff;
			}

			body.light-theme button:hover {
				background: #005f99;
			}

			body.light-theme #contextMenu {
				background: #f0f0f0;
				border: 1px solid #ccc;
				color: #000;
				box-shadow: 0 0 5px #aaa;
			}

			body.light-theme #contextMenu li:hover {
				background: #007acc;
			}

			body.light-theme #counter {
				background: #f0f0f0;
				box-shadow: 0 0 5px #aaa;
				border: 1px solid #ccc;
				color: #333;
			}

			body.light-theme #loadingScreen {
				background: #eee;
				color: #111;
			}

			body.light-theme #loadingScreen .loader {
				background: #eee;
				color: #111;
				border: 6px solid rgb(179, 179, 179);
				border-top: 6px solid #007acc;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}

				100% {
					transform: rotate(360deg);
				}
			}

		</style>
	</head>

	<body>
		<div id="loadingScreen">
			<div class="loader"></div>
			<p id="loading-message">Carregando Joao TextEditor...</p>
			<noscript>
				<style>
					#loading-message {
						display: none;
					}

				</style>
				<p style="color: red; font-weight: bold;">
					Este app precisa de JavaScript para funcionar. Ative o JavaScript ou use outro navegador.
				</p>
			</noscript>
		</div>
		<header oncontextmenu="return false;">
			<div>Joao TextEditor (jTE)</div>
			<div role="group" aria-label="A√ß√µes de texto">
				<span>v1.0.2</span>
				<button onclick="saveFile()" aria-label="Baixar o texto como arquivo txt">üíæ Baixar</button>
				<button onclick="openFile()" aria-label="Abrir um arquivo">üìÇ Abrir</button>
				<button onclick="clearText()" aria-label="Limpar o texto da √°rea de edi√ß√£o de texto">üßπ Limpar</button>
				<button onclick="openTab()" aria-label="Abrir o texto numa nova aba para imprimir etc.">üñ®Ô∏è Nova Aba</button>
				<button onclick="toggleTheme()">üåì Tema</button>
			</div>
		</header>

		<textarea id="editor" aria-label="√Årea de edi√ß√£o de texto" role="textbox" aria-multiline="true" placeholder="Digite aqui ou clique com o bot√£o direito do mouse para abrir o menu de contexto..."></textarea>

		<div id="counter" aria-live="polite">
			Contador carregando...
		</div>

		<div id="contextMenu" oncontextmenu="return false;">
			<ul>
				<li onclick="cutText()">Recortar</li>
				<li onclick="copyText()">Copiar</li>
				<li onclick="pasteText()">Colar</li>
				<li onclick="selectAll()">Selecionar Tudo</li>
				<li onclick="clearText()">Limpar Texto</li>
			</ul>
		</div>

		<input type="file" id="fileInput" style="display:none" />

		<script>
			const root = typeof window !== "undefined" ? window : self;
			const editor = document.getElementById('editor');
			const contextMenu = document.getElementById('contextMenu');
			editor.addEventListener('contextmenu', function (e) {
				e.preventDefault();
				const menuWidth = 180;
				const menuHeight = 185;
				const viewportWidth = root.innerWidth;
				const viewportHeight = root.innerHeight;
				let posX = e.pageX;
				let posY = e.pageY;
				if (posX + menuWidth > viewportWidth) {
					posX = viewportWidth - menuWidth;
				}
				if (posY + menuHeight > viewportHeight) {
					posY = viewportHeight - menuHeight;
				}
				contextMenu.style.top = `${posY}px`;
				contextMenu.style.left = `${posX}px`;
				contextMenu.style.display = 'block';
			});
			document.addEventListener('click', () => {
				contextMenu.style.display = 'none';
			});

			function selectAll() {
				editor.select();
			}

			function copyText() {
				const selected = editor.value.substring(editor.selectionStart, editor.selectionEnd);
				navigator.clipboard.writeText(selected || editor.value)
					.catch(err => alert('Parece que a permiss√£o foi negada para copiar o texto. Interaja no editor e tente novamente. Erro: ' + err));
			}

			function pasteText() {
				navigator.clipboard.readText()
					.then(text => {
						const start = editor.selectionStart;
						const end = editor.selectionEnd;
						const before = editor.value.substring(0, start);
						const after = editor.value.substring(end);
						editor.value = before + text + after;
						editor.selectionStart = editor.selectionEnd = start + text.length;
					})
					.catch(err => alert('Parece que a permiss√£o foi negada para colar o texto. Interaja no editor e tente novamente. Erro: ' + err));
			}

			function cutText() {
				const selected = editor.value.substring(editor.selectionStart, editor.selectionEnd);
				navigator.clipboard.writeText(selected || editor.value)
					.then(() => {
						const start = editor.selectionStart;
						const end = editor.selectionEnd;
						editor.value = editor.value.substring(0, start) + editor.value.substring(end);
						editor.selectionStart = editor.selectionEnd = start;
					})
					.catch(err => alert('Parece que a permiss√£o foi negada para recortar o texto. Interaja no editor e tente novamente. Erro: ' + err));
			}

			function saveFile() {
				const blob = new Blob([editor.value], {
					type: 'text/plain'
				});
				const link = document.createElement('a');
				link.download = 'text.txt';
				link.href = URL.createObjectURL(blob);
				link.click();
			}

			function openFile() {
				const input = document.getElementById('fileInput');
				input.click();
				input.onchange = () => {
					const file = input.files[0];
					const reader = new FileReader();
					reader.onload = () => {
						editor.value = reader.result;
					};
					reader.readAsText(file);
				};
			}
			editor.addEventListener('input', () => {
				localStorage.setItem('joao_texteditor_content', editor.value);
			});
			root.addEventListener('DOMContentLoaded', () => {
				const saved = localStorage.getItem('joao_texteditor_content');
				if (saved) editor.value = saved;
			});

			function clearText() {
				editor.value = '';
				localStorage.removeItem('joao_texteditor_content');
			}

			function toggleTheme() {
				const isLight = document.body.classList.contains('light-theme');
				if (isLight) {
					document.body.classList.remove('light-theme');
					localStorage.setItem('jTE_theme', 'dark');
				}
				else {
					document.body.classList.add('light-theme');
					localStorage.setItem('jTE_theme', 'light');
				}
			}
			const savedTheme = localStorage.getItem('jTE_theme');
			if (savedTheme === 'light') {
				document.body.classList.add('light-theme');
			}
			window.addEventListener('resize', () => contextMenu.style.display = 'none');

			function openTab() {
				const text = editor.value;
				const newWindow = root.open('about:blank#jTEPage', '_blank');
				const htmlContent = `
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>jTE Page</title>
  <style>
    * {
      transition: .3s;
    }

    body {
      font-family: 'Times New Roman', Georgia,  serif;
      background: #fdfdfd;
      color: #222;
      padding: 40px;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .text-div .p-text { font-family: Arial, Helvetica, Roboto, sans-serif; text-align: center; }

    .toolbar {
      margin-bottom: 20px;
	  background: #333;
	  padding: 10px 20px;
	  border-radius: 1em;
	  box-shadow: 0 0 10px rgba(0,0,0,0.5);
	  display: flex;
	  justify-content: center;
	  align-items: center;
    }

    button {
      padding: 8px 16px;
      margin-right: 10px;
	  background: #0999f8;
      
      color: #fff;
      border: none;
      border-radius: 1em;
      font-size: 14px;
      cursor: pointer;
    }

	button:hover {
		background: #007acc;
	}
    pre {
      width: 100%;
      max-width: 800px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 20px;
      font-size: 16px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      border-radius: 1em;
    }

    pre:focus { outline: 1px solid blue }

    @media print {
      *, *:focus { outline: none; }
      .do-not-print { display: none; visibility: hidden; }
      html,body { padding: 0; background: #fff; color: #000; }
      pre { border: none; box-shadow: none; border-radius: 0; }
    }

	@media (prefers-color-scheme: dark) {
     pre { background: #1e1e1e; color: #d4d4d4; border: 1px solid #444; box-shadow: 0 0 10px rgba(0,0,0,0.5);  }
     body { background: #121212; color: #ddd;  }
	 .toolbar { background: #1e1e1e; box-shadow: 0 0 10px rgba(1,1,1,0.7);  }
	 }
  </style>
</head>
<body>
  <div class="toolbar do-not-print">
    <button onclick="self.print()">Imprimir</button>
    <button onclick="self.close()">Fechar aba</button>
  </div>

  <pre contenteditable="true" aria-label="√Årea de edi√ß√£o tempor√°ria" aria-multiline="true">${text.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/&/g, '&amp;')}</pre>
<div class="text-div do-not-print">
  <p class="p-text">jTE Page</p>
  <p class="p-text" style="color: #cc0000; font-weight: bold;">
‚ö†Ô∏è Esta √© uma p√°gina tempor√°ria. Recarregar ir√° apagar o conte√∫do.
  </p>
  <p class="p-text">Para imprimir via teclado, pressione Ctrl + P</p>
</div>
</body>
</html>
  `;
				newWindow.document.documentElement.innerHTML = htmlContent;
			}
			const counter = document.getElementById('counter');

			function updateCounter() {
				const text = editor.value;
				const charCount = text.length;
				const wordCount = text.trim() ? text.trim()
					.split(/\s+/)
					.length : 0;
				const lineCount = text.split(/\r\n|\r|\n/)
					.length;
				counter.textContent = `${charCount} caracteres, ${wordCount} palavras, ${lineCount} linhas`;
			}
			editor.addEventListener('input', () => {
				updateCounter();
			});
			document.addEventListener('keydown', (e) => {
				if (e.ctrlKey) {
					switch (e.key.toLowerCase()) {
					case 's':
						e.preventDefault();
						saveFile();
						break;
					case 'o':
						e.preventDefault();
						openFile();
						break;
					case 'l':
						e.preventDefault();
						clearText();
						break;
					case 'p':
						e.preventDefault();
						openTab();
						break;
					}
				}
				else if (e.shiftKey) {
					switch (e.key.toLowerCase()) {
					case 't':
						e.preventDefault();
						toggleTheme();
						break;
					case 'f':
						e.preventDefault();
						editor.focus();
						break;
					case 'b':
						e.preventDefault();
						editor.blur();
						break;
					}
				}
			});
			root.addEventListener('load', () => {
				const loading = document.getElementById('loadingScreen');
				if (loading) loading.style.display = 'none';
				setTimeout(() => {
					editor.focus();
					updateCounter()
				}, 100);
			});

		</script>
	</body>

</html>
